<!DOCTYPE html>
<html>
  <head> </head>
  <body>
    <h1>Test page for iframe error objects</h1>
    <div>
      <div>Note: for best results, please run with flags: E.g.,:</div>
      <pre style="white-space: break-spaces">
"C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe" --js-flags="--expose-gc --enable-precise-memory-info"</pre
      >
      <div>You will need to quit any existing Edge/Chrome processes first via Task Manager before these flags take effect.</div>
    </div>
    <div>
      <span>Stats: </span>
      <span>Iteration #</span><span id="iteration-number"></span> <span>, memory = </span><span id="memory"></span>
      &nbsp;&nbsp;
      <button id="copy-stats">Copy stats to clipboard</button>
      <button id="update-heap-stats">Update heap size stats</button>
    </div>

    <label for="after-adding-iframe">After adding iframe:</label>
    <select id="after-adding-iframe">
      <option value="nothing">Do nothing -- (no leak)</option>
      <option value="change-iframe-background">Change iframe background -- (no leak)</option>
      <option value="log-hello-world-inside-iframe">Log "Hello World" INSIDE iframe -- (no leak)</option>
      <option value="log-error-in-iframe">Log error INSIDE iframe -- (**CAUSES A LEAK**)</option>
      <option value="throw-unhandled-error-in-iframe">Throw unhandled error INSIDE iframe -- (**CAUSES A LEAK**)</option>
      <option value="throw-handled-error-in-iframe">Handle a thrown error INSIDE iframe -- (no leak)</option>
      <option value="log-error-outside">Log error *OUTSIDE* of iframe -- (no leak)</option>
      <option value="log-structured-clone-error-in-iframe">Log structured clone error INSIDE iframe -- (**CAUSES A LEAK**)</option>
      <option value="log-stringified-error-in-iframe">Log stringified error INSIDE iframe -- (no leak)</option>
      <option value="log-object-in-iframe">Log an object with properties INSIDE iframe -- (**CAUSES A LEAK**)</option>
      <option value="log-weakref-object-in-iframe">Log a WeakRef object INSIDE iframe -- (**CAUSES A LEAK**)</option>
      <option value="log-pretty-print-string-in-iframe">Log a pretty-print string INSIDE iframe -- (no leak)</option>
      <option value="override-console-error-in-iframe-prod">Log error INSIDE iframe, with PRODUCTION patch -- (**CAUSES A LEAK**)</option>
      <option value="override-console-error-in-iframe-fixed">Log error INSIDE iframe, with FIXED patch -- (no leak)</option>
    </select>

    <button id="add-iframe">Add iframe</button>
    <button id="remove-iframe">Remove iframe</button>

    <hr />
    <h2>Run it in a loop?</h2>
    <label for="stop-at-iteration-number">Stop at iteration #:</label>
    <input type="number" id="stop-at-iteration-number" value="100" />
    <button id="loop-go-or-stop">Go!</button>
    <hr />

    <div id="main"></div>

    <script src="./index.js"></script>
  </body>
</html>
